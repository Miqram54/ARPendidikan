<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>AR Graduation Character</title>
    <!-- include three.js library -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js'></script>
    <!-- include jsartookit -->
    <script src="jsartoolkit5/artoolkit.min.js"></script>
    <script src="jsartoolkit5/artoolkit.api.js"></script>
    <!-- include threex.artoolkit -->
    <script src="threex/threex-artoolkitsource.js"></script>
    <script src="threex/threex-artoolkitcontext.js"></script>
    <script src="threex/threex-arbasecontrols.js"></script>
    <script src="threex/threex-armarkercontrols.js"></script>
</head>

<body style='margin: 0px; overflow: hidden; font-family: Monospace; background-color: #000;'>

<script>
var scene, camera, renderer, clock, deltaTime, totalTime;
var arToolkitSource, arToolkitContext;
var markerRoot1;
var graduationCharacter;

initialize();
animate();

function initialize() {
    scene = new THREE.Scene();

    // Improved lighting for better 3D model visibility
    let ambientLight = new THREE.AmbientLight(0x404040, 0.6);
    scene.add(ambientLight);
    
    let directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(1, 1, 1);
    scene.add(directionalLight);

    camera = new THREE.Camera();
    scene.add(camera);

    renderer = new THREE.WebGLRenderer({
        antialias: true,
        alpha: true
    });
    renderer.setClearColor(new THREE.Color('lightgrey'), 0);
    renderer.setSize(640, 480);
    renderer.domElement.style.position = 'absolute';
    renderer.domElement.style.top = '0px';
    renderer.domElement.style.left = '0px';
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    document.body.appendChild(renderer.domElement);

    clock = new THREE.Clock();
    deltaTime = 0;
    totalTime = 0;

    ////////////////////////////////////////////////////////////
    // setup arToolkitSource
    ////////////////////////////////////////////////////////////
    arToolkitSource = new THREEx.ArToolkitSource({
        sourceType: 'webcam',
    });

    function onResize() {
        arToolkitSource.onResize();
        arToolkitSource.copySizeTo(renderer.domElement);
        if (arToolkitContext.arController !== null) {
            arToolkitSource.copySizeTo(arToolkitContext.arController.canvas);
        }
    }

    arToolkitSource.init(function onReady() {
        onResize();
    });

    window.addEventListener('resize', function() {
        onResize();
    });

    ////////////////////////////////////////////////////////////
    // setup arToolkitContext
    ////////////////////////////////////////////////////////////
    arToolkitContext = new THREEx.ArToolkitContext({
        cameraParametersUrl: 'data/camera_para.dat',
        detectionMode: 'mono'
    });

    arToolkitContext.init(function onCompleted() {
        camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());
    });

    ////////////////////////////////////////////////////////////
    // setup markerRoots and 3D Character
    ////////////////////////////////////////////////////////////
    markerRoot1 = new THREE.Group();
    scene.add(markerRoot1);
    
    let markerControls1 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot1, {
        type: 'pattern', 
        patternUrl: "data/hiro.patt",
    });

    // Create graduation character (simplified version using basic geometries)
    createGraduationCharacter();
}

function createGraduationCharacter() {
    graduationCharacter = new THREE.Group();

    // Body (cylinder for torso)
    const bodyGeometry = new THREE.CylinderGeometry(0.15, 0.2, 0.5, 8);
    const bodyMaterial = new THREE.MeshLambertMaterial({ color: 0x000080 }); // Dark blue graduation gown
    const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
    body.position.y = 0.25;
    graduationCharacter.add(body);

    // Head (sphere)
    const headGeometry = new THREE.SphereGeometry(0.12, 16, 16);
    const headMaterial = new THREE.MeshLambertMaterial({ color: 0xffdbac }); // Skin color
    const head = new THREE.Mesh(headGeometry, headMaterial);
    head.position.y = 0.62;
    graduationCharacter.add(head);

    // Graduation cap base
    const capBaseGeometry = new THREE.CylinderGeometry(0.13, 0.13, 0.03, 16);
    const capBaseMaterial = new THREE.MeshLambertMaterial({ color: 0x000000 });
    const capBase = new THREE.Mesh(capBaseGeometry, capBaseMaterial);
    capBase.position.y = 0.75;
    graduationCharacter.add(capBase);

    // Graduation cap top (square board)
    const capTopGeometry = new THREE.BoxGeometry(0.3, 0.02, 0.3);
    const capTopMaterial = new THREE.MeshLambertMaterial({ color: 0x000000 });
    const capTop = new THREE.Mesh(capTopGeometry, capTopMaterial);
    capTop.position.y = 0.77;
    graduationCharacter.add(capTop);

    // Tassel
    const tasselGeometry = new THREE.CylinderGeometry(0.005, 0.015, 0.1, 8);
    const tasselMaterial = new THREE.MeshLambertMaterial({ color: 0xffd700 }); // Gold tassel
    const tassel = new THREE.Mesh(tasselGeometry, tasselMaterial);
    tassel.position.set(0.12, 0.73, 0.12);
    tassel.rotation.z = Math.PI / 6;
    graduationCharacter.add(tassel);

    // Arms
    const armGeometry = new THREE.CylinderGeometry(0.03, 0.04, 0.3, 8);
    const armMaterial = new THREE.MeshLambertMaterial({ color: 0x000080 });
    
    const leftArm = new THREE.Mesh(armGeometry, armMaterial);
    leftArm.position.set(-0.18, 0.35, 0);
    leftArm.rotation.z = Math.PI / 6;
    graduationCharacter.add(leftArm);

    const rightArm = new THREE.Mesh(armGeometry, armMaterial);
    rightArm.position.set(0.18, 0.35, 0);
    rightArm.rotation.z = -Math.PI / 6;
    graduationCharacter.add(rightArm);

    // Hands
    const handGeometry = new THREE.SphereGeometry(0.04, 8, 8);
    const handMaterial = new THREE.MeshLambertMaterial({ color: 0xffdbac });
    
    const leftHand = new THREE.Mesh(handGeometry, handMaterial);
    leftHand.position.set(-0.25, 0.2, 0);
    graduationCharacter.add(leftHand);

    const rightHand = new THREE.Mesh(handGeometry, handMaterial);
    rightHand.position.set(0.25, 0.2, 0);
    graduationCharacter.add(rightHand);

    // Diploma (cylinder for rolled paper)
    const diplomaGeometry = new THREE.CylinderGeometry(0.02, 0.02, 0.15, 8);
    const diplomaMaterial = new THREE.MeshLambertMaterial({ color: 0xf5f5dc }); // Beige/cream color
    const diploma = new THREE.Mesh(diplomaGeometry, diplomaMaterial);
    diploma.position.set(0.25, 0.2, 0);
    diploma.rotation.z = Math.PI / 2;
    graduationCharacter.add(diploma);

    // Red ribbon on diploma
    const ribbonGeometry = new THREE.TorusGeometry(0.025, 0.005, 4, 8);
    const ribbonMaterial = new THREE.MeshLambertMaterial({ color: 0xff0000 });
    const ribbon = new THREE.Mesh(ribbonGeometry, ribbonMaterial);
    ribbon.position.set(0.25, 0.2, 0);
    ribbon.rotation.y = Math.PI / 2;
    graduationCharacter.add(ribbon);

    // Legs
    const legGeometry = new THREE.CylinderGeometry(0.04, 0.05, 0.4, 8);
    const legMaterial = new THREE.MeshLambertMaterial({ color: 0x000080 });
    
    const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
    leftLeg.position.set(-0.08, -0.2, 0);
    graduationCharacter.add(leftLeg);

    const rightLeg = new THREE.Mesh(legGeometry, legMaterial);
    rightLeg.position.set(0.08, -0.2, 0);
    graduationCharacter.add(rightLeg);

    // Shoes
    const shoeGeometry = new THREE.BoxGeometry(0.08, 0.05, 0.15);
    const shoeMaterial = new THREE.MeshLambertMaterial({ color: 0x000000 });
    
    const leftShoe = new THREE.Mesh(shoeGeometry, shoeMaterial);
    leftShoe.position.set(-0.08, -0.42, 0.03);
    graduationCharacter.add(leftShoe);

    const rightShoe = new THREE.Mesh(shoeGeometry, shoeMaterial);
    rightShoe.position.set(0.08, -0.42, 0.03);
    graduationCharacter.add(rightShoe);

    // Scale and position the entire character
    graduationCharacter.scale.set(1.5, 1.5, 1.5);
    graduationCharacter.position.y = 0.5;

    markerRoot1.add(graduationCharacter);
}

function update() {
    if (arToolkitSource.ready !== false)
        arToolkitContext.update(arToolkitSource.domElement);
    
    // Add some animation to make the character more lively
    if (graduationCharacter) {
        graduationCharacter.rotation.y += 0.005; // Slow rotation
        graduationCharacter.position.y = 0.5 + Math.sin(totalTime * 2) * 0.05; // Gentle bobbing motion
    }
}

function render() {
    renderer.render(scene, camera);
}

function animate() {
    requestAnimationFrame(animate);
    deltaTime = clock.getDelta();
    totalTime += deltaTime;
    update();
    render();
}
</script>

</body>
</html>
